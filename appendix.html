<!DOCTYPE html>
<html>
  <head>
    <title>Appendix &middot; Spatial Microsimulation with R.</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="www/bootstrap.min.css" rel="stylesheet">
    <link href="www/highlight.css" rel="stylesheet">

    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700'
      rel='stylesheet' type='text/css'>
  </head>

  <body>

    <div class="container">

      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
              Table of contents<b class="caret"></b>
            </a>
            <ul class="dropdown-menu pull-right" role="menu">
              <li><a href="introduction.html">Introduction</a></li>
<li><a href="what-is-smsim.html">What is spatial microsimulation?</a></li>
<li><a href="SimpleWorld.html">SimpleWorld</a></li>
<li><a href="data-prep.html">Preparing input data</a></li>
<li><a href="smsim-in-R.html">Spatial microsimulation in R</a></li>
<li><a href="CakeMap.html">CakeMap</a></li>
<li><a href="smsim-for-abm.html">Spatial microsimulation for agent-based models</a></li>
<li><a href="additional.html">Additional tools and techniques</a></li>
<li><a href="appendix.html">Appendix</a></li>
<li><a href="glossary.html">Glossary</a></li>
<li><a href="references.html">References</a></li>

            </ul>
          </li>
        </ul>

        <h3 class="muted"><a href="http://robinlovelace.net/spatial-microsim-book/">Spatial Microsimulation with R</a> <small>by Robin Lovelace</small></h3>
        <hr>
      </div>

      <div class="row">
        <div class="col-sm-3" id="nav">
        <div class="well">
          Comming soon as a physical book</a>.
        </div>

        <h4>Contents</h4>
          <ul class="list-unstyled" id="toc"></ul>

          <hr>
          <!--<p><a href="/contribute.html">How to contribute</a></p>-->

          <p><a class="btn btn-primary" href="https://github.com/RobinLovelace/spatial-microsim-book/edit/master/appendix.Rmd">Edit this page</a></p>
        </div>

        <div id="content" class="col-sm-8 pull-right">
          <h1 id="apR">Appendix: Getting up-to-speed with R</h1>
<p>As mentioned in Chapter 1, R is a general purpose programming language focussed on data analysis and modelling. This small tutorial aims to teach the basics of R, from the perspective of spatial microsimulation research. It should also be useful to people with existing R skills, to re-affirm their knowledge base and see how it is applicable to spatial microsimulation.</p>
<p>R’s design is built on the idea that “everything is an object and everything that happens is a function”. It is a <em>vectorised</em>, <em>object orientated</em> and <em>functional</em> programming language (Wickham, 2014). This means that R understands vector algebra, all data accessible to R resides in a number of named objects and that a function must be used to modify any object. We will look at each of these in some code below.</p>
<h2>R understands vector algebra</h2>
<p>A vector is simply an ordered list of numbers (Beezer, 2008). Imagine two vectors, each consisting of 3 elements:</p>
<p><br /><span class="math"><em>a</em> = (1, 2, 3); <em>b</em> = (9, 8, 6)</span><br /></p>
<p>To say that R understands vector algebra is to say that it knows how to handle vectors in the same way a mathematician does:</p>
<p><br /><span class="math"><em>a</em> + <em>b</em> = (<em>a</em><sub>1</sub> + <em>b</em><sub>1</sub>, <em>a</em><sub>2</sub> + <em>b</em><sub>2</sub>, <em>c</em><sub>3</sub> + <em>c</em><sub>3</sub>) = (10, 10, 9)</span><br /></p>
<p>This may not seem remarkable, but it is. Most programming languages are not vectorised, so they would see <span class="math"><em>a</em> + <em>b</em></span> differently. In Python, for example, this is the answer we get:<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<pre class="sourceCode python"><code class="sourceCode python">a = [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>]
b = [<span class="dv">9</span>,<span class="dv">8</span>,<span class="dv">6</span>]
<span class="dt">print</span>(a + b)</code></pre>
<p><code>## [1, 2, 3, 9, 8, 6]</code></p>
<p>In R, the operation <em>just works</em>, intuitively:</p>
<pre class="sourceCode r"><code class="sourceCode r">a &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)
b &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>, <span class="dv">8</span>, <span class="dv">6</span>)
a +<span class="st"> </span>b
<span class="co">#&gt; [1] 10 10  9</span></code></pre>
<p>This conciseness is clearly very useful in spatial microsimulation, as numeric variables of the same length are common (e.g. the attributes of individuals in a zone) and can be acted on with a minimum of effort.</p>
<h2>R is object orientated</h2>
<p>In R, everything that exists is an object with a name and a class. This is useful, because R’s functions know automatically how to behave differently on different objects depending on their class.</p>
<p>To illustrate the point, let’s create two objects, each with a different class and see how the function <code>summarise</code> behaves differently, depending on the type. This behavior is <em>polymorphism</em> (Matloff, 2011):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a character and a vector object</span>
char_obj &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>)
num_obj &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="fl">532.1</span>)

<span class="co"># Summary of each object</span>
<span class="kw">summary</span>(char_obj)
<span class="co">#&gt;    Length     Class      Mode </span>
<span class="co">#&gt;         4 character character</span>
<span class="kw">summary</span>(num_obj)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;     1.0     1.8     3.0   135.0   136.0   532.0</span>

<span class="co"># Summary of a factor object</span>
fac_obj &lt;-<span class="st"> </span><span class="kw">factor</span>(char_obj)
<span class="kw">summary</span>(fac_obj)
<span class="co">#&gt;  blue green   red </span>
<span class="co">#&gt;     1     1     2</span></code></pre>
<p>In the example above, the output from <code>summary</code> for the numeric object <code>num_obj</code> was very different from that of the character vector <code>char_obj</code>. Note that although the same information was contained in <code>fac_obj</code> (a factor), the output from <code>summary</code> changes again.</p>
<p>Note that objects can be called almost anything in R with the exceptions of names beginning with a number or containing operator symbols such as <code>-</code>, <code>^</code> and brackets. It is good practice to think about what the purpose of an object is before naming it: using clear and concise names can save you a huge amount of time in the long run.</p>
<h2 id="subsetting">Subsetting in R</h2>
<p>R has powerful, concise and (over time) intuitive methods for taking subsets of data. Using the SimpleWorld example we loaded in <em>Data preparation</em>, let’s explore the <code>ind</code> object in more detail, to see how we can select the parts of an object we are most interested in. As before, we need to load the data:</p>
<pre class="sourceCode r"><code class="sourceCode r">ind &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/SimpleWorld/ind.csv&quot;</span>) </code></pre>
<p>Now, it is easy from within R to call a single individual (e.g. individual 3) using the square bracket notation:</p>
<pre class="sourceCode r"><code class="sourceCode r">ind[<span class="dv">3</span>,]
<span class="co">#&gt;   id age sex</span>
<span class="co">#&gt; 3  3  35   m</span></code></pre>
<p>The above example takes a subset of <code>ind</code> all elements present on the 3rd row: for a 2 dimensional table, anything to the left of the comma refers to rows and anything to the right refers to columns. Note that <code>ind[2:3,]</code> and <code>ind[c(3,5),]</code> also take subsets of the <code>ind</code> object: the square brackets can take <em>vector</em> inputs as well as single numbers.</p>
<p>We can also subset by columns: the second dimension. Confusingly, this can be done in four ways, because <code>ind</code> is an R <code>data.frame</code><a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> and a data frame can behave simultaneously as a list, a matrix and a data frame (only the results of the first are shown):</p>
<pre class="sourceCode r"><code class="sourceCode r">ind$age <span class="co"># data.frame column name notation I</span>
<span class="co">#&gt; [1] 59 54 35 73 49</span>
<span class="co"># ind[, 2] # matrix notation</span>
<span class="co"># ind[&quot;age&quot;] # column name notation II</span>
<span class="co"># ind[[2]] # list notation</span>
<span class="co"># ind[2] # numeric data frame notation</span></code></pre>
<p>It is also possible to subset cells by both rows and columns simultaneously. Let us select query the gender of the 4th individual, as an example (pay attention to the relative location of the comma inside the square brackets):</p>
<pre class="sourceCode r"><code class="sourceCode r">ind[<span class="dv">4</span>, <span class="dv">3</span>] <span class="co"># The attribute of the 4th individual in column 3</span>
<span class="co">#&gt; [1] f</span>
<span class="co">#&gt; Levels: f m</span></code></pre>
<p>A commonly used trick in R that helps with the analysis of individual-level data is to subset a data frame based on one or more of its variables. Let’s subset first all females in our dataset and then all females over 50:</p>
<pre class="sourceCode r"><code class="sourceCode r">ind[ind$sex ==<span class="st"> &quot;f&quot;</span>, ]
<span class="co">#&gt;   id age sex</span>
<span class="co">#&gt; 4  4  73   f</span>
<span class="co">#&gt; 5  5  49   f</span>
ind[ind$sex ==<span class="st"> &quot;f&quot;</span> &amp;<span class="st"> </span>ind$age &gt;<span class="st"> </span><span class="dv">50</span>, ]
<span class="co">#&gt;   id age sex</span>
<span class="co">#&gt; 4  4  73   f</span></code></pre>
<p>In the above code, R uses relational operators of equality (<code>==</code>) and inequality (<code>&gt;</code>) which can be used in combination using the <code>&amp;</code> symbol. This works because, as well as integer numbers, one can also place <em>boolean</em> variables into square brackets: <code>ind$sex == &quot;f&quot;</code> returns a binary vector consisting solely of <code>TRUE</code> and <code>FALSE</code> values.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<h2 id="further">Further R resources</h2>
<p>The above tutorial should provide a sufficient grounding in R for beginners to understand the practical examples in the book. However, R is a deep language and there is much else to learn that will be of benefit to your modelling skills. There are many books excellent and tutorials that teach the fundamentals of R for a variety of applications. The following resources, in ascending order of difficulty, are highly recommended:</p>
<ul>
<li><em>Introduction to visualising spatial data in R</em> (Lovelace and Cheshire, 2014) provides an introductory tutorial on handling spatial data in R, including the administrative zone data which often form the building blocks of spatial microsimulation models in R.</li>
<li><em>Introduction to scientific programming and simulation using R</em> (Jones et al., 2014) is an accessible and highly practical course that will form a solid foundation for a range of modelling applications, including spatial microsimulation.</li>
<li><em>An Introduction to R</em> (Venables et al., 2014) is the foundational introductory R manual, written by the software’s core developers and is available online for free. It is terse and covers some advanced topics, but provides a useful reference on the fundamentals of R as a language.</li>
<li><em>Advanced R</em> (Wickham, 2014) (<a href="http://www.crcpress.com/product/isbn/9781466586963">http://www.crcpress.com/product/isbn/9781466586963</a>) delves into the heart of the R language. It contains many advanced topics, but the introductory chapters are straightforward. Browsing some of the pages on Advanced R’s website (<a href="http://adv-r.had.co.nz/">http://adv-r.had.co.nz/</a>) and trying to answer the questions that open each chapter provides a taster of the book and an excellent way of testing and improving one’s understanding of the R language.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># There are alternatives to R and in the next section we will consider a few of these.</span></code></pre>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>We can get the right answer in Python, by typing the following: <code>import numpy; a=numpy.array([1,2,3]); b=numpy.array([9,8,6]); a+b</code>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>This can be ascertained by typing <code>class(ind)</code>. It is useful to know the class of different R objects, so make good use of the <code>class()</code> function.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Thus, yet another way to invoke the 2nd column of <code>ind</code> is the following: <code>ind[c(F, T, F)]</code>! Here, <code>T</code> and <code>F</code> are shorthand for “TRUE” and “FALSE” respectively.<a href="#fnref3">↩</a></p></li>
</ol>
</div>

        </div>
      </div>

      <div class="footer">
        <hr>
        <p>&copy; Site design: Hadley Wickham. Powered by <a href="http://jekyllrb.com/">jekyll</a>,
          <a href="http://yihui.name/knitr/">knitr</a>, and
          <a href="http://johnmacfarlane.net/pandoc/">pandoc</a>. Source
          available on <a href="https://github.com/robinlovelace/spatial-microsim-book/">github</a>.
        </p>
      </div>

    </div> <!-- /container -->

  <script src="//code.jquery.com/jquery.js"></script>
  <script src="www/bootstrap.min.js"></script>
  <script src="www/toc.js"></script>
  </body>
</html>
